<!DOCTYPE html>
<!-- saved from url=(0039)http://192.168.0.82/settings/um?um=a2dp -->
<html>
    <head lang="en">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=500" />
        <meta
            content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"
            name="viewport" />
        <title>Usermod Settings</title>
        <script>
            var d = document;
            (d.max_gpio = 39), (d.um_p = []), (d.rsvd = []), (d.ro_gpio = []);
            var owner,
                locip,
                urows,
                umCfg = {},
                pins = [],
                pinO = [],
                loc = !1;
            function gId(e) {
                return d.getElementById(e);
            }
            function isO(e) {
                return e && "object" == typeof e && !Array.isArray(e);
            }
            function H() {
                window.open(
                    "https://github.com/MoonModules/WLED/wiki/Settings#usermod-settings"
                );
            }
            function B() {
                window.open("/settings", "_self");
            }
            function loadJS(e, t = !0) {
                let n = d.createElement("script");
                n.setAttribute("src", e),
                    n.setAttribute("type", "text/javascript"),
                    n.setAttribute("async", t),
                    d.body.appendChild(n),
                    n.addEventListener("load", () => {
                        GetV();
                        for (let e = 0; e < d.rsvd.length; e++)
                            pins.push(d.rsvd[e]), pinO.push("rsvd");
                        -1 == d.um_p[0] && d.um_p.shift();
                    }),
                    n.addEventListener("error", e => {
                        console.log("Error on loading file", e),
                            alert(
                                "Loading of configuration script failed.\nIncomplete page data!"
                            );
                    });
            }
            function S() {
                "file:" == window.location.protocol &&
                    ((loc = !0),
                    (locip = localStorage.getItem("locIp")) ||
                        ((locip = prompt("File Mode. Please enter WLED IP!")),
                        localStorage.setItem("locIp", locip))),
                    ldS();
            }
            function isF(e) {
                return e === +e && e !== (0 | e);
            }
            function isI(e) {
                return e === +e && e === (0 | e);
            }
            function getPins(e) {
                if (isO(e))
                    for (const [n, o] of Object.entries(e))
                        if (isO(o)) (owner = n), getPins(o);
                        else if ("pin" == n.replace("[]", "").substr(-3))
                            if (Array.isArray(o))
                                for (var t = 0; t < o.length; t++)
                                    o[t] >= 0 &&
                                        (pins.push(o[t]), pinO.push(owner));
                            else o >= 0 && (pins.push(o), pinO.push(owner));
                        else if (Array.isArray(o))
                            for (t = 0; t < o.length; t++) getPins(o[t]);
            }
            function initCap(e) {
                return "string" != typeof e
                    ? ""
                    : e
                          .replace(/[\W_]/g, " ")
                          .replace(/(^\w{1})|(\s+\w{1})/g, e =>
                              e.toUpperCase()
                          );
            }
            function addField(e, t, n, o = !1) {
                if (isO(n)) {
                    (urows += '<hr class="sml">'),
                        "unknown" === t ||
                            e.includes(":") ||
                            (urows += `<p><u>${initCap(t)}</u></p>`);
                    for (const [o, l] of Object.entries(n))
                        "unknown" === t || e.includes(":")
                            ? addField(e, o, l)
                            : addField(e + ":" + t, o, l);
                } else if (Array.isArray(n))
                    for (var l = 0; l < n.length; l++) addField(e, t, n[l], !0);
                else {
                    var i,
                        s = typeof n;
                    switch (s) {
                        case "boolean":
                            (s = "checkbox"),
                                (i = 'value="true"' + (n ? " checked" : ""));
                            break;
                        case "number":
                            (i = `value="${n}"`),
                                "pin" === t.substr(-3)
                                    ? ((i += ' max="50" min="-1" class="s"'),
                                      (s = "int"))
                                    : (i += ' step="any" class="xxl"');
                            break;
                        default:
                            (s = "text"),
                                (i = `value="${n}" style="width:250px;"`);
                    }
                    if (
                        ((urows += ` ${initCap(t)} `),
                        "checkbox" == s
                            ? (urows += `<input type="hidden" name="${e}:${t}${
                                  o ? "[]" : ""
                              }" value="false">`)
                            : o ||
                              (urows += `<input type="hidden" name="${e}:${t}${
                                  o ? "[]" : ""
                              }" value="${s}">`),
                        t.includes("pin"))
                    ) {
                        this.name.replace("[]", "").substr(-3);
                        urows += `<select name="${e}:${t}${
                            o ? "[]" : ""
                        }" style="width:200px;max-width:90%;">`;
                        for (l = -1; l <= 50; l++) {
                            let t = -1;
                            for (var r = 0; r < pins.length; r++)
                                pins[r] == l && (t = r);
                            (urows += `<option value="${l}"`),
                                l == n && (urows += " selected"),
                                t >= 0 &&
                                    (e.includes(pinO[t]) ||
                                        (urows += " disabled")),
                                (urows += -1 == l ? ">undefined" : ">" + l),
                                t >= 0 &&
                                    ((urows +=
                                        " " +
                                        ("if" == pinO[t] ? "global" : pinO[t])),
                                    e.includes(pinO[t])
                                        ? (urows += " ðŸŸ¢")
                                        : (urows += " ðŸ”´")),
                                (urows += "</option>");
                        }
                        urows += "</select>";
                    } else
                        urows += `<input type="${
                            "int" === s ? "number" : s
                        }" name="${e}:${t}${o ? "[]" : ""}" ${i}>`;
                    urows += "<br>";
                }
            }
            function addDropdown(e, t) {
                let n = d.createElement("select"),
                    o = d.getElementsByName(e + ":" + t)[1];
                if (
                    o &&
                    "INPUT" === o.tagName &&
                    ("text" === o.type || "number" === o.type)
                ) {
                    let e = o.value;
                    o.name;
                    for (var l = 0; l < o.attributes.length; ++l) {
                        var i = o.attributes[l];
                        "type" != i.name &&
                            "value" != i.name &&
                            "class" != i.name &&
                            "style" != i.name &&
                            n.setAttribute(i.name, i.value);
                    }
                    return (
                        n.setAttribute("data-val", e),
                        o.parentElement.replaceChild(n, o),
                        n
                    );
                }
                return null;
            }
            function addOption(e, t, n) {
                if (null === e) return;
                let o = d.createElement("option");
                (o.value = n), (o.text = t), e.appendChild(o);
                for (let t = 0; t < e.childNodes.length; t++) {
                    e.childNodes[t].value == e.dataset.val &&
                        (e.selectedIndex = t);
                }
            }
            function rOpt(e, t, n, o) {
                let l = d.getElementsByName(e);
                var i = l;
                l[t] && (i = l[t]);
                for (let e = 0; e < i.childNodes.length; e++) {
                    let t = i.childNodes[e];
                    t.value == o && (t.text = n);
                }
            }
            function xOpt(e, t, n, o) {
                let l = d.getElementsByName(e);
                var i = l;
                l[t] && (i = l[t]);
                for (let e = 0; e < i.childNodes.length; e++) {
                    let t = i.childNodes[e];
                    t.value == o && (t.text += n);
                }
            }
            function dOpt(e, t, n, o) {
                let l = d.getElementsByName(e);
                var i = l;
                l[t] && (i = l[t]);
                for (let e = 0; e < i.options.length; e++) {
                    let t = i.options[e];
                    t.value >= n && t.value <= o && (i.removeChild(t), e--);
                }
            }
            function aOpt(e, t) {
                let n = d.getElementsByName(e);
                var o = n;
                n[t] && (o = n[t]);
                for (let e = 0; e < o.options.length; e++) {
                    let t = o.options[e];
                    found = !1;
                    for (let e = 0; e < d.a_pins.length; e++)
                        d.a_pins[e] == t.value && (found = !0);
                    -1 == t.value || found || (o.removeChild(t), e--);
                }
            }
            function dRO(e, t) {
                let n = d.getElementsByName(e);
                var o = n;
                n[t] && (o = n[t]);
                for (let e = 0; e < o.options.length; e++) {
                    let t = o.options[e];
                    for (let e = 0; e < d.ro_gpio.length; e++)
                        d.ro_gpio[e] == t.value && (t.disabled = !0);
                }
            }
            function pinPost() {
                for (var e, t = gId("form_s").elements, n = 0; (e = t[n++]); )
                    if (e.name.includes("pin") && null != e.options)
                        for (let t = 0; t < e.options.length; t++) {
                            let n = e.options[t];
                            for (let e = 0; e < d.ro_gpio.length; e++)
                                d.ro_gpio[e] == n.value &&
                                    (n.text += " read only ðŸŸ ");
                            for (let e = 0; e < d.rsvd.length; e++)
                                d.rsvd[e] == n.value &&
                                    ((n.text += " reserved ðŸŸ£"),
                                    (n.disabled = !0));
                            n.value > d.max_gpio && (e.removeChild(n), t--),
                                n.text.length <= 4 && (n.text += " ðŸŸ¢");
                            for (let e = 0; e < d.dt_pins.length; e++)
                                d.dt_pins[e] == n.value &&
                                    (n.text +=
                                        e < 9
                                            ? " D" + e
                                            : 9 == e
                                            ? " RX"
                                            : " TX");
                            for (let e = 0; e < d.a_pins.length; e++)
                                d.a_pins[e] == n.value && (n.text += " A" + e);
                        }
            }
            function addInfo(e, t, n, o = "") {
                let l = d.getElementsByName(e);
                l.length &&
                    ("string" == typeof t && l[0]
                        ? (l[0].placeholder = t)
                        : l[t] &&
                          ("" != n &&
                              l[t].insertAdjacentHTML("afterend", "&nbsp;" + n),
                          "" != o &&
                              l[t].insertAdjacentHTML(
                                  "beforebegin",
                                  o + "&nbsp;"
                              )));
            }
            function addHB(e) {
                addInfo(
                    e + ":help",
                    0,
                    '<button onclick="location.href=&quot;https://mm.kno.wled.ge/usermods/' +
                        e +
                        '&quot;" type="button">?</button>'
                );
            }
            function ldS() {
                fetch((loc ? "http://" + locip : "") + "/cfg.json", {
                    method: "get",
                })
                    .then(
                        e => (
                            e.ok || (gId("lserr").style.display = "inline"),
                            e.json()
                        )
                    )
                    .then(e => {
                        (umCfg = e.um), getPins(e), (urows = "");
                        const t = window.location.search,
                            n = new URLSearchParams(t).get("um");
                        if (
                            (null == n &&
                                ((urows +=
                                    "<hr><h2>Usermods (Pin Manager)</h2>"),
                                (urows +=
                                    '<button onclick="location.href=&quot;https://mm.kno.wled.ge/usermods/pinmanager&quot;" type="button">?</button>'),
                                (urows += '<hr class="sml">'),
                                (urows +=
                                    '<i style="color:orange">(change requires reboot!)</i>'),
                                (urows += '<hr class="sml">'),
                                (urows +=
                                    "<p><u>Global I2C GPIOs (HW)</u></p>"),
                                addField("if:SDA", "pin", -1, !1),
                                addField("if:SCL", "pin", -1, !1),
                                (urows += '<hr class="sml">'),
                                (urows +=
                                    "<p><u>Global SPI GPIOs (HW)</u></p>"),
                                addField("if:MOSI", "pin", -1, !1),
                                addField("if:MISO", "pin", -1, !1),
                                addField("if:SCLK", "pin", -1, !1)),
                            isO(umCfg))
                        ) {
                            for (const [e, t] of Object.entries(umCfg))
                                n == e &&
                                    ((urows += `<hr><h3>${e}</h3><div name="${e}:help"></div>`),
                                    addField(e, "unknown", t));
                            if (
                                (null != n &&
                                    "" === urows &&
                                    (urows =
                                        "Usermods configuration not found.<br>Press <i>Save</i> to initialize defaults."),
                                null == n)
                            ) {
                                (urows += "<hr> "),
                                    (urows += '<div style="margin: auto;">'),
                                    (urows +=
                                        '<table style="margin-left:auto; margin-right:auto;">'),
                                    (urows +=
                                        "<tr><th>Usermod</th><th>Enabled</th></tr>");
                                for (const [e, t] of Object.entries(umCfg))
                                    urows += `<tr><td>${e}</td><td>${t.enabled}</td></tr>`;
                                (urows += "</table>"), (urows += "</div>");
                            }
                        }
                        gId("um").innerHTML = urows;
                        var o =
                            (loc ? "http://" + locip : "") +
                            "/settings/s.js?p=8";
                        null != n && (o += "&um=" + n), loadJS(o, !1);
                    })
                    .catch(e => {
                        (gId("lserr").style.display = "inline"), console.log(e);
                    });
            }
            function svS(e) {
                e.preventDefault(), d.Sf.checkValidity() && d.Sf.submit();
            }
        </script>
        <style>
            @import url("style.css");
        </style>
    </head>
    <body onload="S()" cz-shortcut-listen="true">
        <form id="form_s" name="Sf" method="post" onsubmit="svS(event)">
            <div class="toprow">
                <div class="helpB">
                    <button type="button" onclick="H()">?</button>
                </div>
                <button type="button" onclick="B()">Back</button
                ><button type="submit">Save</button><br />
                <span id="lssuc" style="color: green; display: none"
                    >âœ” Configuration saved!
                </span>
                <span id="lserr" style="color: red; display: none">
                    âš  Could not load configuration.</span
                >
            </div>
            <div id="um">
                <hr />
                <h3>a2dp</h3>
                <hr class="sml" />
                <i style="color: orange">(change requires reboot!)</i>
                <div name="a2dp:help"></div>
                <hr class="sml" />
                Enabled
                <input type="hidden" name="a2dp:enabled" value="false" /><input
                    type="checkbox"
                    name="a2dp:enabled"
                    value="true"
                    checked="" /><br />
                InternalDac
                <input
                    type="hidden"
                    name="a2dp:internalDac"
                    value="false" /><input
                    type="checkbox"
                    name="a2dp:internalDac"
                    value="true" />&nbsp;Use internal Digital-to-analog
                converter<br />
                BtName
                <input type="hidden" name="a2dp:btName" value="text" /><input
                    type="text"
                    name="a2dp:btName"
                    value="Forty-Two"
                    style="width: 250px" />&nbsp;Name to appear as<br />
                Pin
                <select name="a2dp:pin[]" style="width: 200px; max-width: 90%">

                </select>
                Pin
                <select name="a2dp:pin[]" style="width: 200px; max-width: 90%"></select>
                Pin
                <select name="a2dp:pin[]" style="width: 200px; max-width: 90%">
                    </select><br />
            </div>
            <div name="errorMessage"></div>
            <hr />
            <button type="button" onclick="B()">Back</button
            ><button type="submit">Save</button>
        </form>
        <script
            src="./Usermod Settings_files/s.js.letÃ¶ltÃ©s"
            type="text/javascript"
            async="false"></script>
    </body>
</html>
